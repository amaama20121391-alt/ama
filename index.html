<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%237b1fa2'/><text x='50%' y='55%' text-anchor='middle' font-size='50' fill='white' font-family='Arial' dy='.3em'>âˆ‘</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #f3e5f5);
      color: #111;
      padding: 24px;
    }
    .card {
      max-width: 820px;
      margin: 24px auto;
      padding: 28px;
      border-radius: 16px;
      background: #ffffffcc;
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 25px rgba(0,0,0,0.12);
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    h1 {
      margin: 0 0 16px;
      font-size: 26px;
      color: #4a148c;
      text-align: center;
    }
    label {
      display: block;
      margin: 14px 0 6px;
      font-weight: 600;
      color: #333;
    }
    input[type=text], select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 16px;
      transition: border 0.2s;
    }
    input[type=text]:focus {
      border-color: #7b1fa2;
      outline: none;
      box-shadow: 0 0 8px rgba(123,31,162,0.2);
    }
    button {
      margin-top: 16px;
      padding: 12px 20px;
      border-radius: 12px;
      border: none;
      background: #7b1fa2;
      color: white;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #9c27b0;
    }
    pre {
      background: #1a237e;
      color: #e8eaf6;
      padding: 16px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 15px;
    }
    .row {
      display: flex;
      gap: 14px;
    }
    .col {
      flex: 1;
    }
    .small {
      font-size: 14px;
      color: #555;
    }
    details summary {
      cursor: pointer;
      font-weight: 500;
      color: #7b1fa2;
      margin-top: 12px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nerdamer/1.1.11/nerdamer.core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nerdamer/1.1.11/Algebra.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nerdamer/1.1.11/Calculus.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nerdamer/1.1.11/Extra.min.js"></script>
</head>
<body>
  <div class="card">
    <h1>Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª â€” Ø³Ø§Ø¯Ù‡ Ùˆ Ø³Ø±ÛŒØ¹</h1>
    <p class="small">ÙØ±Ù…ÙˆÙ„ ÛŒØ§ Ø¹Ø¨Ø§Ø±Øª Ù…Ø¹Ø§Ø¯Ù„Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§: <code>x^2 - 2 = 0</code>ØŒ <code>sin(x) - 0.5 = 0</code>ØŒ <code>2x+3=7</code>.</p>

    <label for="equation">Ù…Ø¹Ø§Ø¯Ù„Ù‡</label>
    <input id="equation" type="text" placeholder="Ù…Ø«Ø§Ù„: 2x+3=7" value="2x+3=7">

    <label for="variable">Ù…ØªØºÛŒØ± (Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)</label>
    <input id="variable" type="text" value="x">

    <div class="row">
      <div class="col">
        <label for="range">Ø¯Ø§Ù…Ù†Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ Ø¹Ø¯Ø¯ÛŒ (Ø¨Ø±Ø§ÛŒ ØªÙˆØ§Ø¨Ø¹)</label>
        <input id="range" type="text" value="-100,100">
      </div>
      <div class="col">
        <label for="tolerance">Ø§ÛŒÙ¾Ø³Ù„ÙˆÙ† (Ø¯Ù‚Øª Ø¹Ø¯Ø¯ÛŒ)</label>
        <input id="tolerance" type="text" value="1e-9">
      </div>
    </div>

    <button id="solveBtn">Ø­Ù„ Ú©Ù†</button>

    <h3>Ù†ØªÛŒØ¬Ù‡</h3>
    <pre id="output">Ù‡ÛŒÚ†â€Œ Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ù‡Ù†ÙˆØ²</pre>

    <details>
      <summary>ØªÙˆØ¶ÛŒØ­Ø§Øª / Ø±ÙˆØ´</summary>
      <p class="small">Ø§Ø¨ØªØ¯Ø§ ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø­Ù„ ØªØ­Ù„ÛŒÙ„ÛŒ Ø¨Ø§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ <em>nerdamer</em> Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯. Ø§Ú¯Ø± Ø­Ù„ ØªØ­Ù„ÛŒÙ„ÛŒ Ù…Ù…Ú©Ù† Ù†Ø¨ÙˆØ¯ ÛŒØ§ Ù…Ø¹Ø§Ø¯Ù„Ù‡ Ø¹Ø¯Ø¯ÛŒ Ø¨ÙˆØ¯ØŒ Ø§Ø² Ø±ÙˆØ´ Ù†Ù…ÙˆÙ†Ù‡â€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ + Ù‚Ø·Ø¹â€ŒÙ†Ù‚Ø·Ù‡ (bisection) Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø±ÛŒØ´Ù‡â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
    </details>
  </div>

<script>
  // âœ… ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¶Ø±Ø¨â€ŒÙ‡Ø§ÛŒ Ø¶Ù…Ù†ÛŒ
  function insertImplicitMultiplication(eq) {
    // Ø¹Ø¯Ø¯ Ø¯Ø± Ú©Ù†Ø§Ø± Ù…ØªØºÛŒØ± ÛŒØ§ Ù¾Ø±Ø§Ù†ØªØ² (2x â†’ 2*x)
    eq = eq.replace(/(\d)([a-zA-Z(])/g, '$1*$2');
    // Ù…ØªØºÛŒØ± Ø¯Ø± Ú©Ù†Ø§Ø± Ù¾Ø±Ø§Ù†ØªØ² (x(x+1) â†’ x*(x+1))
    eq = eq.replace(/([a-zA-Z])\(/g, '$1*(');
    // Ù¾Ø±Ø§Ù†ØªØ² Ø¨Ø³ØªÙ‡ Ø¯Ø± Ú©Ù†Ø§Ø± Ù…ØªØºÛŒØ± ÛŒØ§ Ø¹Ø¯Ø¯ ()(x) â†’ )*(x)
    eq = eq.replace(/\)(\s*)(\d|[a-zA-Z(])/g, ')*$1$2');
    return eq;
  }

  function normalizeEquation(eq){ 
    if(eq.indexOf('=')!==-1){ 
      const parts = eq.split('='); 
      return '(' + parts.slice(0,parts.length-1).join('=') + ')-(' + parts[parts.length-1] + ')'; 
    } 
    return '('+eq+')'; 
  }

  function trySymbolicSolve(expr, variable){ 
    if(typeof nerdamer==='undefined')return null; 
    try{ 
      if(typeof nerdamer.solve==='function'){ 
        return nerdamer.solve(expr, variable); 
      } 
      if(typeof nerdamer.solveEquations==='function'){ 
        return nerdamer.solveEquations([expr]); 
      } 
    }catch(e){console.warn('symbolic failed',e);} 
    return null; 
  }

  function evalNumeric(expr, variable, value){ 
    try{ 
      if(typeof nerdamer!=='undefined'){ 
        const replaced=expr.replace(new RegExp('\\b'+variable+'\\b','g'),'('+value+')'); 
        return parseFloat(nerdamer(replaced).evaluate().text()); 
      } 
    }catch(e){} 
    try{ 
      const fn=new Function(variable,'return ('+expr+');'); 
      return Number(fn(value)); 
    }catch(e){return NaN;} 
  }

  function bisectionRoot(expr,variable,a,b,tol,maxIter=60){
    let fa=evalNumeric(expr,variable,a);
    let fb=evalNumeric(expr,variable,b);
    if(isNaN(fa)||isNaN(fb))return null;
    if(fa===0)return a;
    if(fb===0)return b;
    if(fa*fb>0)return null;
    let lo=a,hi=b,mid,fmid;
    for(let i=0;i<maxIter;i++){
      mid=(lo+hi)/2;
      fmid=evalNumeric(expr,variable,mid);
      if(Math.abs(fmid)<=tol)return mid;
      if(fa*fmid<=0){hi=mid;fb=fmid;}else{lo=mid;fa=fmid;}
    }
    return(lo+hi)/2;
  }

  function numericScanAndSolve(expr,variable,rangeStr,tol){
    const parts=rangeStr.split(',').map(s=>parseFloat(s.trim()));
    const a=parts[0]||-100,b=parts[1]||100;
    const samples=2000;
    const xs=[];
    for(let i=0;i<=samples;i++)xs.push(a+(b-a)*i/samples);
    const values=xs.map(x=>evalNumeric(expr,variable,x));
    const roots=[];
    for(let i=0;i<samples;i++){
      const x1=xs[i],x2=xs[i+1];
      const v1=values[i],v2=values[i+1];
      if(isNaN(v1)||isNaN(v2))continue;
      if(Math.abs(v1)<tol)roots.push(x1);
      if(v1*v2<0){
        const root=bisectionRoot(expr,variable,x1,x2,tol);
        if(root!==null){
          if(!roots.some(r=>Math.abs(r-root)<1e-7))roots.push(root);
        }
      }
    }
    const last=xs[xs.length-1];
    if(Math.abs(values[values.length-1])<tol)roots.push(last);
    return roots.sort((a,b)=>a-b);
  }

  document.getElementById('solveBtn').addEventListener('click',()=>{
    let eqText=document.getElementById('equation').value.trim();
    eqText = insertImplicitMultiplication(eqText); // ğŸ”§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯

    const variable=document.getElementById('variable').value.trim()||'x';
    const rangeStr=document.getElementById('range').value.trim();
    const tol=parseFloat(document.getElementById('tolerance').value)||1e-9;
    const out=document.getElementById('output');

    out.textContent='Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø­Ù„...';

    if(!eqText){
      out.textContent='Ù„Ø·ÙØ§Ù‹ Ù…Ø¹Ø§Ø¯Ù„Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.';
      return;
    }

    const expr=normalizeEquation(eqText);
    const sym=trySymbolicSolve(expr,variable);

    if(sym){
      try{
        let text='';
        if(Array.isArray(sym)){
          if(sym.length===0)
            text='Ø­Ù„ Ù†Ù…ÛŒØ´ÙˆØ¯ ÛŒØ§ Ø¬ÙˆØ§Ø¨ ØµØ±ÛŒØ­ Ù†Ø¯Ø§Ø±Ø¯.';
          else
            text='Ø¬ÙˆØ§Ø¨(Ù‡Ø§ÛŒ Ù†Ù…Ø§Ø¯ÛŒÙ†):\n'+sym.map(s=>String(s)).join('\n');
        }else{
          text='Ø¬ÙˆØ§Ø¨ Ù†Ù…Ø§Ø¯ÛŒÙ†: '+String(sym);
        }
        out.textContent=text;
        return;
      }catch(e){console.warn(e);}
    }

    try{
      const roots=numericScanAndSolve(expr,variable,rangeStr,tol);
      if(roots.length===0){
        out.textContent='Ù‡ÛŒÚ† Ø±ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ù…Ø´Ø®Øµâ€ŒØ´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.';
      }else{
        let t='Ø±ÛŒØ´Ù‡(Ù‡Ø§) Ø¹Ø¯Ø¯ÛŒ:\n';
        for(let r of roots){t+=r+'\n';}
        out.textContent=t;
      }
    }catch(e){
      out.textContent='Ø®Ø·Ø§ Ø¯Ø± Ø­Ù„ Ø¹Ø¯Ø¯ÛŒ: '+e;
    }
  });
</script>
</body>
</html>
