<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ú†Øª Ø¹Ù…ÙˆÙ…ÛŒ (Ù…Ø­Ù„ÛŒ + Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ§ÛŒÙ„)</title>
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--accent:#60a5fa;--muted:#9aa9bd}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:IRANSans,system-ui,Segoe UI,Arial;color:#e6eef8;background:linear-gradient(180deg,#071022,#041323)}
    .wrap{max-width:900px;margin:28px auto;border-radius:12px;overflow:hidden;display:grid;grid-template-columns:1fr 300px;gap:0;box-shadow:0 10px 40px rgba(2,6,23,0.6)}
    main{background:var(--card);padding:18px;display:flex;flex-direction:column;min-height:520px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    header h1{font-size:18px;margin:0}
    #status{margin-left:auto;font-size:13px;color:var(--muted)}
    .messages{flex:1;overflow:auto;padding-right:8px}
    .msg{margin:8px 0;padding:10px;border-radius:10px;display:inline-block;max-width:78%}
    .msg .who{font-size:12px;color:var(--muted);margin-bottom:6px}
    .msg.me{background:linear-gradient(90deg, rgba(96,165,250,0.12), rgba(96,165,250,0.05));align-self:flex-end}
    .msg.other{background:rgba(255,255,255,0.03)}
    .composer{display:flex;gap:8px;padding-top:12px;align-items:center}
    input[type=text].compose{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    input[type=file]{display:none}
    button{background:var(--accent);border:none;color:#05203a;padding:10px 14px;border-radius:10px;cursor:pointer}
    .file-icon{display:inline-flex;align-items:center;gap:6px;text-decoration:none;color:inherit;background:rgba(255,255,255,0.05);padding:6px 10px;border-radius:8px;}
    .file-icon:hover{background:rgba(255,255,255,0.08)}
    aside{background:linear-gradient(180deg,#071022,#0b1220);padding:18px;border-left:1px solid rgba(255,255,255,0.03)}
    .panel{display:flex;flex-direction:column;gap:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:12px;border-radius:10px}
    .small{font-size:13px;color:var(--muted)}
    .user-list{max-height:240px;overflow:auto}
    .user{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:6px}
    .tools{display:flex;flex-direction:column;gap:8px}
    footer{font-size:13px;color:var(--muted);margin-top:8px}
    @media (max-width:800px){.wrap{grid-template-columns:1fr;padding:8px}.aside-hidden{display:none}}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <main>
      <header>
        <h1>Ú†Øª Ø¹Ù…ÙˆÙ…ÛŒ â€” Ù…Ø­Ù„ÛŒ + ÙØ§ÛŒÙ„</h1>
        <div id="status">Ø¢ÙÙ„Ø§ÛŒÙ† Ù…Ø­Ù„ÛŒ</div>
      </header>

      <div class="messages" id="messages" aria-live="polite"></div>

      <div class="composer">
        <input id="inputMsg" class="compose" type="text" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." autocomplete="off" />
        <label for="fileInput" title="Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„" style="cursor:pointer;background:rgba(255,255,255,0.1);padding:8px;border-radius:8px;">ğŸ“</label>
        <input id="fileInput" type="file" multiple />
        <button id="btnSend">Ø§Ø±Ø³Ø§Ù„</button>
      </div>

      <footer>Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ (localStorage). Ù‡ÛŒÚ†â€ŒÚ†ÛŒØ² Ø¢Ù¾Ù„ÙˆØ¯ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.</footer>
    </main>

    <aside>
      <div class="panel">
        <div class="card">
          <div class="small">Ù†Ø§Ù… Ø´Ù…Ø§</div>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <input id="nick" type="text" placeholder="Ù†Ø§Ù… (Ù…Ù‡Ù…Ø§Ù†)" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit" />
            <button id="btnSet">Ø«Ø¨Øª</button>
          </div>
        </div>

        <div class="card">
          <div class="small">Ø§ÙØ±Ø§Ø¯ Ù…Ø­Ù„ÛŒ</div>
          <div class="user-list" id="users"></div>
        </div>

        <div class="card tools">
          <button id="btnExport">ØµØ§Ø¯Ø±Ø§Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ (JSON)</button>
          <input id="importFile" type="file" accept="application/json" />
          <button id="btnClear">Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
        </div>
      </div>
    </aside>
  </div>

  <script>
    const STORAGE_KEY = 'local-public-chat:v2';
    const messagesEl = document.getElementById('messages');
    const usersEl = document.getElementById('users');
    const inputMsg = document.getElementById('inputMsg');
    const btnSend = document.getElementById('btnSend');
    const nickInput = document.getElementById('nick');
    const btnSet = document.getElementById('btnSet');
    const fileInput = document.getElementById('fileInput');

    let nick = localStorage.getItem('nick') || '';
    let messages = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(messages)); }
    function iconForFile(name){
      const ext = name.split('.').pop().toLowerCase();
      if(['png','jpg','jpeg','gif','webp','svg'].includes(ext)) return 'ğŸ–¼ï¸';
      if(['mp4','mov','avi','mkv'].includes(ext)) return 'ğŸï¸';
      if(['mp3','wav','ogg'].includes(ext)) return 'ğŸµ';
      if(['pdf'].includes(ext)) return 'ğŸ“„';
      if(['zip','rar','7z'].includes(ext)) return 'ğŸ“¦';
      if(['doc','docx'].includes(ext)) return 'ğŸ“';
      if(['xls','xlsx','csv'].includes(ext)) return 'ğŸ“Š';
      if(['ppt','pptx'].includes(ext)) return 'ğŸ“½ï¸';
      return 'ğŸ“';
    }

    function render(){
      messagesEl.innerHTML='';
      messages.forEach(m=>{
        const div=document.createElement('div');div.className='msg '+(m.nick===nick?'me':'other');
        const who=document.createElement('div');who.className='who';who.textContent=m.nick+' â€¢ '+new Date(m.ts).toLocaleString();
        div.appendChild(who);
        if(m.type==='text'){
          const body=document.createElement('div');body.textContent=m.msg;div.appendChild(body);
        } else if(m.type==='file'){
          const link=document.createElement('a');
          link.href=m.data;link.download=m.name;link.className='file-icon';
          link.innerHTML=iconForFile(m.name)+' '+m.name;
          div.appendChild(link);
        }
        messagesEl.appendChild(div);
      });
      messagesEl.scrollTop=messagesEl.scrollHeight;
    }

    function sendMessage(obj){
      messages.push(obj);save();render();
    }

    btnSend.onclick=()=>{
      const txt=inputMsg.value.trim();
      if(txt){sendMessage({type:'text',nick,msg:txt,ts:Date.now()});inputMsg.value='';}
    };

    fileInput.onchange=async(e)=>{
      const files=e.target.files;
      for(const f of files){
        const reader=new FileReader();
        reader.onload=()=>{
          sendMessage({type:'file',nick,name:f.name,data:reader.result,ts:Date.now()});
        };
        reader.readAsDataURL(f);
      }
      fileInput.value='';
    };

    btnSet.onclick=()=>{
      const n=nickInput.value.trim();if(!n)return alert('Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');nick=n;localStorage.setItem('nick',nick);render();
    };

    render();
    if(nick) nickInput.value=nick;
  </script>
</body>
</html>
